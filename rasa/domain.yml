version: "3.1"

intents:
  - greet
  - goodbye
  - report_fire
  - inform
  - affirm
  - deny

entities:
  - site_type
  - house_location
  - is_critical
  - is_high
  - is_rising

slots:
  # ===== SITE SELECTION =====
  site_type:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: site_type
        conditions:
          - active_loop: site_selection_form
            requested_slot: site_type

  # ===== HOUSE =====
  house_location:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: house_location
        conditions:
          - active_loop: house_fire_form
            requested_slot: house_location

  # ===== RISK QUESTIONS (shared across multiple forms) =====
  is_critical:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: yes
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_critical
      - type: from_intent
        intent: deny
        value: no
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_critical

  is_high:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: yes
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_high
      - type: from_intent
        intent: deny
        value: no
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_high

  is_rising:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: yes
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_rising
      - type: from_intent
        intent: deny
        value: no
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_rising

  # ===== INTERNAL =====
  requested_slot:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

# ===== FORMS =====
forms:
  # Entry form
  site_selection_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - site_type

  # House
  house_fire_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - house_location
      - is_critical
      - is_high
      - is_rising

# ===== RESPONSES =====
responses:
  # Greetings
  utter_greet:
    - text: "Hello! This is Fire Emergency Assistance. Say 'fire' to report an emergency."

  utter_goodbye:
    - text: "Stay safe! Goodbye."

  utter_fire_reported:
    - text: "üö® Fire Emergency Acknowledged! Stay calm. I need some quick information."

  # ===== SITE SELECTION =====
  utter_ask_site_type:
    - text: "What type of location is on fire?"
      buttons:
        - title: "üè† House"
          payload: '/inform{{"site_type": "house"}}'
        - title: "üè¢ Building (Mall, Office, Hospital)"
          payload: '/inform{{"site_type": "building"}}'
        - title: "üè≠ Factory / Industry"
          payload: '/inform{{"site_type": "factory"}}'
        - title: "üè¨ Warehouse"
          payload: '/inform{{"site_type": "warehouse"}}'
        - title: "üå≤ Forest / Grassland"
          payload: '/inform{{"site_type": "forest"}}'

  # ===== HOUSE =====
  utter_ask_house_location:
    - text: "Where in the house is the fire?"
      buttons:
        - title: "üç≥ Kitchen"
          payload: '/inform{{"house_location": "kitchen"}}'
        - title: "‚ö° Electrical / Technical Room"
          payload: '/inform{{"house_location": "electrical"}}'
        - title: "üõèÔ∏è Bedroom / Living Area"
          payload: '/inform{{"house_location": "bedroom"}}'
        - title: "üöó Garage"
          payload: '/inform{{"house_location": "garage"}}'
        - title: "üî• Near Gas Pipeline / Cylinder"
          payload: '/inform{{"house_location": "gas_area"}}'
        - title: "‚ùì Other"
          payload: '/inform{{"house_location": "other"}}'

  utter_ask_is_critical:
    - text: "üî¥ Are you experiencing any of these CRITICAL situations?\n\n
        ‚Ä¢ Heavy/Black Smoke\n
        ‚Ä¢ Cannot Breathe / Choking\n
        ‚Ä¢ Trapped / Exit Blocked\n
        ‚Ä¢ Someone Injured\n
        ‚Ä¢ Explosion / Cylinder Burst"
      buttons:
        - title: "‚úÖ Yes"
          payload: '/inform{{"is_critical": "yes"}}'
        - title: "‚ùå No"
          payload: '/inform{{"is_critical": "no"}}'

  utter_ask_is_high:
    - text: "üü† Do you see any of these?\n\n‚Ä¢ Visible Flames\n‚Ä¢ Fire Spreading\n‚Ä¢ Burning Embers / Sparks Flying"
      buttons:
        - title: "‚úÖ Yes"
          payload: '/inform{{"is_high": "yes"}}'
        - title: "‚ùå No"
          payload: '/inform{{"is_high": "no"}}'

  utter_ask_is_rising:
    - text: "üü° Do you notice any of these?\n\n‚Ä¢ Light Smoke\n‚Ä¢ Electric Sparks\n‚Ä¢ Pungent Gas Smell"
      buttons:
        - title: "‚úÖ Yes"
          payload: '/inform{{"is_rising": "yes"}}'
        - title: "‚ùå No (Early Stage / No Smoke)"
          payload: '/inform{{"is_rising": "no"}}'

actions:
  - action_reset_slots
  - action_submit_fire_assessment
  - action_route_after_site_selection
  - action_route_after_factory_location
  - action_route_after_warehouse_size
  - validate_house_fire_form
  - validate_factory_outside_form
  - validate_warehouse_small_form
  - validate_forest_fire_form

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: false
