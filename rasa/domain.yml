version: "3.1"

intents:
  - greet
  - goodbye
  - report_fire
  - inform
  - affirm
  - deny
  - pos_inside
  - pos_outside
  - out_of_scope
  - restart

entities:
  - site_type
  - house_location
  - building_location
  - factory_location
  - factory_role
  - warehouse_size
  - warehouse_material
  - is_critical
  - is_high
  - is_rising

slots:
  # SITE SELECTION
  site_type:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: site_type
        conditions:
          - active_loop: site_selection_form
            requested_slot: site_type

  # HOUSE
  house_location:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: house_location
        conditions:
          - active_loop: house_fire_form
            requested_slot: house_location

  building_location:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: pos_inside
        value: inside
        conditions:
          - active_loop: building_location_form
            requested_slot: building_location
      - type: from_intent
        intent: pos_outside
        value: outside
        conditions:
          - active_loop: building_location_form
            requested_slot: building_location

  factory_location:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: pos_inside
        value: inside
        conditions:
          - active_loop: factory_location_form
            requested_slot: factory_location
      - type: from_intent
        intent: pos_outside
        value: outside
        conditions:
          - active_loop: factory_location_form
            requested_slot: factory_location

  factory_role:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: factory_role
        conditions:
          - active_loop: factory_inside_form
            requested_slot: factory_role

  warehouse_size:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: yes
        conditions:
          - active_loop: warehouse_size_form
            requested_slot: warehouse_size
      - type: from_intent
        intent: deny
        value: no
        conditions:
          - active_loop: warehouse_size_form
            requested_slot: warehouse_size

  warehouse_material:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: warehouse_material
        conditions:
          - active_loop: warehouse_small_form
            requested_slot: warehouse_material

  # SHARED RISK QUESTIONS
  is_critical:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: yes
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_critical
          - active_loop: factory_outside_form
            requested_slot: is_critical
          - active_loop: warehouse_small_form
            requested_slot: is_critical
          - active_loop: forest_fire_form
            requested_slot: is_critical
      - type: from_intent
        intent: deny
        value: no
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_critical
          - active_loop: factory_outside_form
            requested_slot: is_critical
          - active_loop: warehouse_small_form
            requested_slot: is_critical
          - active_loop: forest_fire_form
            requested_slot: is_critical

  is_high:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: yes
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_high
          - active_loop: factory_outside_form
            requested_slot: is_high
          - active_loop: warehouse_small_form
            requested_slot: is_high
          - active_loop: forest_fire_form
            requested_slot: is_high
      - type: from_intent
        intent: deny
        value: no
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_high
          - active_loop: factory_outside_form
            requested_slot: is_high
          - active_loop: warehouse_small_form
            requested_slot: is_high
          - active_loop: forest_fire_form
            requested_slot: is_high

  is_rising:
    type: text
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: affirm
        value: yes
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_rising
          - active_loop: factory_outside_form
            requested_slot: is_rising
          - active_loop: warehouse_small_form
            requested_slot: is_rising
          - active_loop: forest_fire_form
            requested_slot: is_rising
      - type: from_intent
        intent: deny
        value: no
        conditions:
          - active_loop: house_fire_form
            requested_slot: is_rising
          - active_loop: factory_outside_form
            requested_slot: is_rising
          - active_loop: warehouse_small_form
            requested_slot: is_rising
          - active_loop: forest_fire_form
            requested_slot: is_rising

  requested_slot:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

# FORMS
forms:
  # Entry form
  site_selection_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - site_type

  # House
  house_fire_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - house_location
      - is_critical
      - is_high
      - is_rising

  building_location_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - building_location

  factory_location_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - factory_location

  factory_inside_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - factory_role

  factory_outside_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - is_critical
      - is_high
      - is_rising

  warehouse_size_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - warehouse_size

  warehouse_large_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots: []

  warehouse_small_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - warehouse_material
      - is_critical
      - is_high
      - is_rising

  forest_fire_form:
    ignored_intents:
      - greet
      - goodbye
    required_slots:
      - is_critical
      - is_high
      - is_rising

responses:
  utter_greet:
    - text: "Hello! This is Fire Emergency Assistance. Say 'fire' to report an emergency."

  utter_goodbye:
    - text: "Stay safe! Goodbye."

  utter_fire_reported:
    - text: "üö® Fire Emergency Acknowledged! Stay calm. I need some quick information."

  utter_ask_site_type:
    - text: "What type of location is on fire?"
      buttons:
        - title: "üè† House"
          payload: '/inform{{"site_type": "house"}}'
        - title: "üè¢ Building (Mall, Office, Hospital)"
          payload: '/inform{{"site_type": "building"}}'
        - title: "üè≠ Factory / Industry"
          payload: '/inform{{"site_type": "factory"}}'
        - title: "üè¨ Warehouse"
          payload: '/inform{{"site_type": "warehouse"}}'
        - title: "üå≤ Forest / Grassland"
          payload: '/inform{{"site_type": "forest"}}'

  utter_ask_house_location:
    - text: "Where in the house is the fire?"
      buttons:
        - title: "üç≥ Kitchen"
          payload: '/inform{{"house_location": "kitchen"}}'
        - title: "‚ö° Electrical / Technical Room"
          payload: '/inform{{"house_location": "electrical"}}'
        - title: "üõèÔ∏è Bedroom / Living Area"
          payload: '/inform{{"house_location": "bedroom"}}'
        - title: "üöó Garage"
          payload: '/inform{{"house_location": "garage"}}'
        - title: "üî• Near Gas Pipeline / Cylinder"
          payload: '/inform{{"house_location": "gas_area"}}'
        - title: "‚ùì Other"
          payload: '/inform{{"house_location": "other"}}'

  utter_ask_building_location:
    - text: "Where are you right now?"
      buttons:
        - title: "üè¢ Inside the Building"
          payload: '/pos_inside{{"building_location": "inside"}}'
        - title: "üö™ Outside the Building"
          payload: '/pos_outside{{"building_location": "outside"}}'

  utter_ask_factory_location:
    - text: "Where are you right now?"
      buttons:
        - title: "üè≠ Inside the Factory"
          payload: '/pos_inside{{"factory_location": "inside"}}'
        - title: "üö™ Outside the Factory"
          payload: '/pos_outside{{"factory_location": "outside"}}'

  utter_ask_factory_role:
    - text: "Are you a worker or visitor?"
      buttons:
        - title: "üë∑ Factory Staff / Worker"
          payload: '/inform{{"factory_role": "worker"}}'
        - title: "üë§ Visitor"
          payload: '/inform{{"factory_role": "visitor"}}'

  utter_ask_warehouse_size:
    - text: "Is this a large facility with a safety department?"
      buttons:
        - title: "‚úÖ Yes (Large / Has Safety Team)"
          payload: '/affirm{{"warehouse_size": "yes"}}'
        - title: "‚ùå No (Small / No Safety Team)"
          payload: '/deny{{"warehouse_size": "no"}}'

  utter_ask_warehouse_material:
    - text: "What is primarily stored in this warehouse?"
      buttons:
        - title: "üëï Garments & Synthetic Fibers"
          payload: '/inform{{"warehouse_material": "garments"}}'
        - title: "‚ö° Electrical & Electronics"
          payload: '/inform{{"warehouse_material": "electrical"}}'
        - title: "üöó Mechanical & Automobiles"
          payload: '/inform{{"warehouse_material": "mechanical"}}'
        - title: "üì¶ Wood / Paper / Cardboard"
          payload: '/inform{{"warehouse_material": "wood"}}'
        - title: "üè∫ Ceramics & Glass"
          payload: '/inform{{"warehouse_material": "ceramics"}}'
        - title: "üõû Rubber / Tires / Plastics"
          payload: '/inform{{"warehouse_material": "rubber"}}'
        - title: "üß™ Chemicals"
          payload: '/inform{{"warehouse_material": "chemicals"}}'
        - title: "‚ùì Mixed / Don't Know"
          payload: '/inform{{"warehouse_material": "mixed"}}'

  utter_ask_is_critical:
    - text: "üî¥ Are you experiencing any of these CRITICAL situations?
        - Heavy/Black Smoke
        - Cannot Breathe / Choking
        - Trapped / Exit Blocked
        - Someone Injured
        - Explosion / Cylinder Burst"
      buttons:
        - title: "‚úÖ Yes"
          payload: '/affirm{{"is_critical": "yes"}}'
        - title: "‚ùå No"
          payload: '/deny{{"is_critical": "no"}}'

  utter_ask_is_high:
    - text: "üü† Do you see any of these?\n\n‚Ä¢ Visible Flames\n‚Ä¢ Fire Spreading\n‚Ä¢ Burning Embers / Sparks Flying"
      buttons:
        - title: "‚úÖ Yes"
          payload: '/affirm{{"is_high": "yes"}}'
        - title: "‚ùå No"
          payload: '/deny{{"is_high": "no"}}'

  utter_ask_is_rising:
    - text: "üü° Do you notice any of these?\n\n‚Ä¢ Light Smoke\n‚Ä¢ Electric Sparks\n‚Ä¢ Pungent Gas Smell"
      buttons:
        - title: "‚úÖ Yes"
          payload: '/affirm{{"is_rising": "yes"}}'
        - title: "‚ùå No (Early Stage / No Smoke)"
          payload: '/deny{{"is_rising": "no"}}'

  utter_out_of_scope:
    - text: "Sorry, I can only help with fire emergencies. Type 'fire' to report one."

  utter_default:
    - text: "I'm sorry, I didn't understand that. Type 'fire' to report a fire emergency."

  utter_please_rephrase:
    - text: "I didn't quite get that. Could you rephrase?"

actions:
  - action_reset_slots
  - action_submit_fire_assessment
  - action_route_after_site_selection
  - action_route_after_factory_location
  - action_route_after_warehouse_size
  - validate_site_selection_form
  - validate_house_fire_form
  - validate_building_location_form
  - validate_factory_outside_form
  - validate_warehouse_small_form
  - validate_forest_fire_form
  - action_default_fallback

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: false
