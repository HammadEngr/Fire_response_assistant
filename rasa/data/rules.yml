version: "3.1"

rules:
  # ===== BASIC =====
  - rule: Greet
    steps:
      - intent: greet
      - action: utter_greet

  - rule: Goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  # ===== ENTRY =====
  - rule: Start fire report
    steps:
      - intent: report_fire
      - action: action_reset_slots
      - action: utter_fire_reported
      - action: site_selection_form
      - active_loop: site_selection_form

  # ===== SITE SELECTION → ROUTE =====
  - rule: Site selection done
    condition:
      - active_loop: site_selection_form
    steps:
      - action: site_selection_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_route_after_site_selection

  # ===== HOUSE FORM → SUBMIT =====
  - rule: House fire form done
    condition:
      - active_loop: house_fire_form
    steps:
      - action: house_fire_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_submit_fire_assessment

    # ===== BUILDING LOCATION → SUBMIT (no more routing, direct submit) =====
  - rule: Building location done
    condition:
      - active_loop: building_location_form
    steps:
      - action: building_location_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_submit_fire_assessment

    # ===== FACTORY LOCATION → ROUTE =====
  - rule: Factory location done
    condition:
      - active_loop: factory_location_form
    steps:
      - action: factory_location_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_route_after_factory_location

  # ===== FACTORY INSIDE → SUBMIT =====
  - rule: Factory inside form done
    condition:
      - active_loop: factory_inside_form
    steps:
      - action: factory_inside_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_submit_fire_assessment

    # ===== FACTORY OUTSIDE → SUBMIT =====
  - rule: Factory outside form done
    condition:
      - active_loop: factory_outside_form
    steps:
      - action: factory_outside_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_submit_fire_assessment

  # ===== WAREHOUSE SIZE → ROUTE =====
  - rule: Warehouse size done
    condition:
      - active_loop: warehouse_size_form
    steps:
      - action: warehouse_size_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_route_after_warehouse_size

  # ===== WAREHOUSE SMALL → SUBMIT =====
  - rule: Warehouse small form done
    condition:
      - active_loop: warehouse_small_form
    steps:
      - action: warehouse_small_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_submit_fire_assessment

  - rule: out of scope
    steps:
      - intent: out_of_scope
      - action: utter_out_of_scope

  - rule: Restart conversation
    steps:
      - intent: restart
      - action: action_restart
      - action: utter_greet
